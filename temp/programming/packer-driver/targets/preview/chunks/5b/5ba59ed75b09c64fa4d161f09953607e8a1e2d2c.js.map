{"version":3,"sources":["file:///F:/Lap%20Trinh%20Game/simple-games/assets/simple-shooting/scripts/ShootingPlayerController.ts"],"names":["_decorator","Component","Node","AnimationComponent","systemEvent","SystemEvent","macro","Vec3","game","Quat","CCFloat","Prefab","director","instantiate","Bullet","ActionType","Grenade","ccclass","property","PlayerAnimState","MoveDir","tempVec3_a","tempVec3_b","tempQuat_a","ShootingPlayerController","type","_animComp","_animState","None","_animStateToNameMap","_moveDirMap","_velocity","_rotHorizontalSpeed","_rotVerticalSpeed","_bulletSpeed","_grenadeForce","onLoad","on","EventType","KEY_UP","onKeyUp","KEY_DOWN","onKeyDown","MOUSE_UP","onMouseUp","MOUSE_DOWN","onMouseDown","TOUCH_MOVE","onTouchMove","Idle","Running","Jumping","Shooting","Left","Right","Forward","Backward","start","node","getComponent","FINISHED","onAnimationEnd","changeToAnimState","doAction","action","enable","z","checkToIdle","x","Shoot","shoot","ThrowGrenade","throwGrenade","event","keyCode","KEY","a","d","w","s","g","space","y","getButton","canvas","requestPointerLock","document","exitPointerLock","onMouseMove","movementX","horizontalRot","getRotation","rotateAround","UNIT_Y","setRotation","movementY","verticalRot","verticalViewNode","UNIT_X","getEulerAngles","viewDownAngle","viewUpAngle","getDelta","state","play","name","scene","getScene","newBullet","BulletPrefab","addChild","setPosition","firePoint","getWorldPosition","bullet","dir","transformQuat","getWorldRotation","multiplyScalar","init","newGrenade","grenatePrfb","throwPoint","grenade","move","deltaTime","curPos","scaleAndAdd","moveSpeed","setWorldPosition","update","onDestroy","off"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, AnimationComponent, systemEvent, SystemEvent, macro, Vec3, math, game, Quat, CCFloat, Prefab, director, instantiate, Scene, EventMouse } from 'cc';\r\nimport { Bullet } from './Bullet';\r\nimport { ActionType } from './GameDefines';\r\nimport { Grenade } from './Grenade';\r\nconst { ccclass, property } = _decorator;\r\n\r\nenum PlayerAnimState {\r\n    None,\r\n    Idle,\r\n    Running,\r\n    Jumping,\r\n    Shooting,\r\n}\r\n\r\nenum MoveDir {\r\n    Left,\r\n    Right,\r\n    Forward,\r\n    Backward,\r\n}\r\n\r\nconst tempVec3_a = new Vec3();\r\nconst tempVec3_b = new Vec3();\r\nconst tempQuat_a = new Quat();\r\n\r\n@ccclass('ShootingPlayerController')\r\nexport class ShootingPlayerController extends Component {\r\n    @property({type: CCFloat})\r\n    public moveSpeed: number = 1;\r\n    @property({type: Prefab})\r\n    public BulletPrefab: Prefab = null;\r\n    @property({type: Prefab})\r\n    public grenatePrfb: Prefab = null;\r\n    @property({type: Node})\r\n    public firePoint: Node = null;\r\n    @property({type: Node})\r\n    public throwPoint: Node = null;\r\n    @property({type: Node})\r\n    public verticalViewNode: Node = null;\r\n    @property({type: CCFloat})\r\n    public viewUpAngle: number = 60;\r\n    @property({type: CCFloat})\r\n    public viewDownAngle: number = -60;\r\n\r\n    private _animComp: AnimationComponent = null;\r\n    private _animState: PlayerAnimState = PlayerAnimState.None;\r\n    private _animStateToNameMap: any = {};\r\n    private _moveDirMap: any = {};\r\n    private _velocity: Vec3 = new Vec3();\r\n    private _rotHorizontalSpeed: number =  0.005;\r\n    private _rotVerticalSpeed: number = 0.002;\r\n    private _bulletSpeed: number = 50;\r\n    private _grenadeForce: number = 50;\r\n\r\n    onLoad() {\r\n        //键盘监听\r\n        systemEvent.on(SystemEvent.EventType.KEY_UP,this.onKeyUp,this);\r\n        systemEvent.on(SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        \r\n        //鼠标监听\r\n        systemEvent.on(SystemEvent.EventType.MOUSE_UP, this.onMouseUp, this);\r\n        systemEvent.on(SystemEvent.EventType.MOUSE_DOWN, this.onMouseDown, this);\r\n        // systemEvent.on(SystemEvent.EventType.MOUSE_MOVE,this.onMouseMove,this);\r\n        \r\n        //触摸监听\r\n        systemEvent.on(SystemEvent.EventType.TOUCH_MOVE,this.onTouchMove,this);\r\n\r\n        this._animStateToNameMap[PlayerAnimState.Idle] = 'Idle';\r\n        this._animStateToNameMap[PlayerAnimState.Running] = 'Run';\r\n        this._animStateToNameMap[PlayerAnimState.Jumping] = 'Jump';\r\n        this._animStateToNameMap[PlayerAnimState.Shooting] = 'ShootTorsoArmsRifle';\r\n\r\n\r\n        this._moveDirMap[MoveDir.Left] = new Vec3(1, 0, 0);\r\n        this._moveDirMap[MoveDir.Right] = new Vec3(-1, 0, 0);\r\n        this._moveDirMap[MoveDir.Forward] = new Vec3(0, 0, 1);\r\n        this._moveDirMap[MoveDir.Backward] = new Vec3(0, 0, -1);\r\n        \r\n    }\r\n\r\n    start () {\r\n        // Your initialization goes here.\r\n        this._animComp = this.node.getComponent(AnimationComponent);\r\n        this._animComp.on(AnimationComponent.EventType.FINISHED, this.onAnimationEnd, this);\r\n        this.changeToAnimState(PlayerAnimState.Idle);\r\n    }\r\n\r\n    doAction(action: ActionType, enable: boolean) {\r\n        switch(action) {\r\n            case ActionType.Forward:\r\n                if (enable) {\r\n                    this._velocity.z = 1;\r\n                    this.changeToAnimState(PlayerAnimState.Running);\r\n                } else {\r\n                    if (this._velocity.z > 0) {\r\n                        this._velocity.z = 0;\r\n                    }\r\n                    this.checkToIdle();\r\n                }\r\n                break;\r\n            case ActionType.Backward:\r\n                if (enable) {\r\n                    this._velocity.z = -1;\r\n                    this.changeToAnimState(PlayerAnimState.Running);\r\n                } else {\r\n                    if (this._velocity.z < 0) {\r\n                        this._velocity.z = 0;\r\n                    }\r\n                    this.checkToIdle();\r\n                }\r\n                break;\r\n            case ActionType.Left:\r\n                if (enable) {\r\n                    this._velocity.x = 1;\r\n                    this.changeToAnimState(PlayerAnimState.Running);\r\n                } else {\r\n                    if (this._velocity.x > 0) {\r\n                        this._velocity.x = 0;\r\n                    }\r\n                    this.checkToIdle();\r\n                }\r\n                break;\r\n            case ActionType.Right:\r\n                if (enable) {\r\n                    this._velocity.x = -1;\r\n                    this.changeToAnimState(PlayerAnimState.Running);\r\n                } else {\r\n                    if (this._velocity.x < 0) {\r\n                        this._velocity.x = 0;\r\n                    }\r\n                    this.checkToIdle();\r\n                }\r\n                break;\r\n            case ActionType.Shoot:\r\n                if (enable) {\r\n                    this.changeToAnimState(PlayerAnimState.Shooting);\r\n                    this.shoot();\r\n                }\r\n                break;\r\n            case ActionType.ThrowGrenade:\r\n                if (enable) {\r\n                    this.throwGrenade();\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    onKeyDown(event){\r\n        switch(event.keyCode) {\r\n            case macro.KEY.a:\r\n                this.doAction(ActionType.Left, true);\r\n                break;\r\n            case macro.KEY.d:\r\n                this.doAction(ActionType.Right, true);\r\n                break;\r\n            case macro.KEY.w:\r\n                this.doAction(ActionType.Forward, true);\r\n                break;\r\n            case macro.KEY.s:\r\n                this.doAction(ActionType.Backward, true);\r\n                break;\r\n            case macro.KEY.g:\r\n                this.doAction(ActionType.ThrowGrenade, true);\r\n                break;\r\n            case macro.KEY.space:\r\n                // this.changeToAnimState(PlayerAnimState.Jumping);\r\n                break;\r\n        }\r\n    }\r\n\r\n    checkToIdle() {\r\n        if (this._velocity.x === 0 &&\r\n            this._velocity.y === 0 &&\r\n            this._velocity.z === 0) {\r\n                this.changeToAnimState(PlayerAnimState.Idle);\r\n            }\r\n    }\r\n\r\n    onKeyUp(event){\r\n        switch(event.keyCode) {\r\n            case macro.KEY.a:\r\n                this.doAction(ActionType.Left, false);\r\n                break;\r\n            case macro.KEY.d:\r\n                this.doAction(ActionType.Right, false);\r\n                break;\r\n            case macro.KEY.w:\r\n                this.doAction(ActionType.Forward, false);\r\n                break;\r\n            case macro.KEY.s:\r\n                this.doAction(ActionType.Backward, false);\r\n                break;\r\n            case macro.KEY.space:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onMouseDown(event) {\r\n        if (event.getButton() === 2) {\r\n            game.canvas.requestPointerLock?.();\r\n        } \r\n\r\n    }\r\n\r\n    onMouseUp(event){\r\n        if (event.getButton() === 0) {  // 鼠标左键\r\n            this.changeToAnimState(PlayerAnimState.Shooting);\r\n            this.shoot();\r\n        } else if (event.getButton() === 2) {\r\n            document.exitPointerLock?.();\r\n        } \r\n    }\r\n\r\n    onMouseMove(event:EventMouse){    \r\n        if(event.movementX != 0){\r\n            const horizontalRot = this.node.getRotation();\r\n            Quat.rotateAround(horizontalRot, horizontalRot, Vec3.UNIT_Y, -event.movementX * this._rotHorizontalSpeed);\r\n            this.node.setRotation(horizontalRot);\r\n        }\r\n\r\n        if(event.movementY != 0) {\r\n            const verticalRot = this.verticalViewNode.getRotation();\r\n            Quat.rotateAround(verticalRot, verticalRot, Vec3.UNIT_X, event.movementY * this._rotVerticalSpeed);\r\n            verticalRot.getEulerAngles(tempVec3_a)\r\n            if (tempVec3_a.x > this.viewDownAngle && tempVec3_a.x < this.viewUpAngle) {\r\n                this.verticalViewNode.setRotation(verticalRot);\r\n            }\r\n        }\r\n    }\r\n\r\n    onTouchMove(event){\r\n        if(event.getDelta().x != 0){\r\n            const horizontalRot = this.node.getRotation();\r\n            Quat.rotateAround(horizontalRot, horizontalRot, Vec3.UNIT_Y, -event.getDelta().x * this._rotHorizontalSpeed);\r\n            this.node.setRotation(horizontalRot);\r\n        }\r\n\r\n        if(event.getDelta().y != 0) {\r\n            const verticalRot = this.verticalViewNode.getRotation();\r\n            Quat.rotateAround(verticalRot, verticalRot, Vec3.UNIT_X, event.getDelta().y * this._rotVerticalSpeed);\r\n            verticalRot.getEulerAngles(tempVec3_a)\r\n            if (tempVec3_a.x > this.viewDownAngle && tempVec3_a.x < this.viewUpAngle) {\r\n                this.verticalViewNode.setRotation(verticalRot);\r\n            }\r\n        }\r\n    }\r\n\r\n    changeToAnimState(state: PlayerAnimState) {\r\n        if (this._animState === PlayerAnimState.Idle) {\r\n            if (this._animState !== state) {\r\n                this._animComp.play(this._animStateToNameMap[state]);\r\n                this._animState = state;\r\n            }\r\n        } else {\r\n            if (state === PlayerAnimState.Idle) {\r\n                this._animComp.play(this._animStateToNameMap[state]);\r\n                this._animState = state;\r\n            }\r\n        }\r\n    }\r\n\r\n    onAnimationEnd(type, state) {\r\n        if (state.name === this._animStateToNameMap[PlayerAnimState.Shooting]) {\r\n            this.changeToAnimState(PlayerAnimState.Idle);\r\n        }\r\n    }\r\n\r\n    shoot() {\r\n        let scene = director.getScene();\r\n        let newBullet: any = instantiate(this.BulletPrefab);\r\n        // ts-ignore\r\n        scene.addChild(newBullet);\r\n        newBullet.setPosition(this.firePoint.getWorldPosition());\r\n        const bullet: Bullet = newBullet.getComponent(Bullet);\r\n        let dir = new Vec3(0, 0, 1);\r\n        Vec3.transformQuat(dir, dir, this.firePoint.getWorldRotation());\r\n        Vec3.multiplyScalar(dir, dir, this._bulletSpeed);\r\n        bullet.init(dir);\r\n    }\r\n\r\n    throwGrenade() {\r\n        let scene = director.getScene();\r\n        let newGrenade: any = instantiate(this.grenatePrfb);\r\n        scene.addChild(newGrenade);\r\n        newGrenade.setPosition(this.throwPoint.getWorldPosition());\r\n        const grenade: Grenade = newGrenade.getComponent(Grenade);\r\n        let dir = new Vec3(0, 0, 1);\r\n        Vec3.transformQuat(dir, dir, this.throwPoint.getWorldRotation());\r\n        Vec3.multiplyScalar(dir, dir, this._grenadeForce);\r\n        grenade.init(dir);\r\n    }\r\n\r\n    move(deltaTime: number) {\r\n        let curPos = tempVec3_a;\r\n        const dir = this._velocity;\r\n        this.node.getWorldPosition(curPos);\r\n        this.node.getWorldRotation(tempQuat_a);\r\n        Vec3.transformQuat(tempVec3_b, dir, tempQuat_a);\r\n        Vec3.scaleAndAdd(curPos, curPos, tempVec3_b, deltaTime * this.moveSpeed);\r\n        this.node.setWorldPosition(curPos);\r\n    }\r\n\r\n    update (deltaTime: number) {\r\n        // Your update function goes here.\r\n        if (this._animState === PlayerAnimState.Running) {\r\n            this.move(deltaTime);\r\n        }\r\n    }\r\n\r\n    onDestroy() {\r\n        // 取消键盘监听\r\n        systemEvent.off(SystemEvent.EventType.KEY_UP,this.onKeyUp,this);\r\n        systemEvent.off(SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this);\r\n        \r\n        // 取消鼠标监听\r\n        systemEvent.off(SystemEvent.EventType.MOUSE_UP, this.onMouseUp, this);\r\n        systemEvent.off(SystemEvent.EventType.MOUSE_DOWN, this.onMouseDown, this);\r\n        // systemEvent.off(SystemEvent.EventType.MOUSE_MOVE,this.onMouseMove,this);\r\n        \r\n        // 取消触摸监听\r\n        systemEvent.off(SystemEvent.EventType.TOUCH_MOVE,this.onTouchMove,this);\r\n    }\r\n}\r\n"]}